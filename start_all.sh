#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã Bonus Education

echo "üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã Bonus Education..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env —Ñ–∞–π–ª–∞
if [ ! -f ".env" ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env —Å —Ç–æ–∫–µ–Ω–∞–º–∏:"
    echo "TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω"
    echo "GOOGLE_AI_API_KEY=–≤–∞—à_–∫–ª—é—á"
    exit 1
fi

echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞"
echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã..."

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-–ø–∞–Ω–µ–ª—å –≤ —Ñ–æ–Ω–µ
echo "üåê –ó–∞–ø—É—Å–∫ –≤–µ–±-–ø–∞–Ω–µ–ª–∏..."
python3 simple_web_panel.py &
WEB_PID=$!

# –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ
sleep 3

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
echo "ü§ñ –ó–∞–ø—É—Å–∫ AI-–±–æ—Ç–∞..."
# –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ .env (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤, –±–µ–∑ eval)
while IFS= read -r line; do
    [ -z "$line" ] && continue
    case "$line" in \#* ) continue ;; esac
    key="${line%%=*}"
    val="${line#*=}"
    # –û–±—Ä–µ–∑–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –≤–æ–∫—Ä—É–≥ –∫–ª—é—á–∞
    key="${key%% }"; key="${key## }"
    [ -z "$key" ] && continue
    export "$key=$val"
done < .env
python3 final_bot.py &
BOT_PID=$!

echo "‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞!"
echo "üåê –í–µ–±-–ø–∞–Ω–µ–ª—å: http://localhost:8000"
echo "ü§ñ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Telegram"
echo ""
echo "–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
trap "echo 'üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã...'; kill $WEB_PID $BOT_PID; exit" INT

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
wait

